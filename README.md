# FFT4CM4F

This is a collection of FFT routines for the Cortex-M4 Processor with FPU, aka M4F.

It is based on djbfft from D.J.Bernstein, which in 1999 was the fastest FFT for processors without a SIMD unit such as SSE, Altivec or Neon. This makes it an ideal choice for Cortex-M4F, which comes with an FPU but no SIMD. 
The original is still here: https://cr.yp.to/djbfft.html

Although fast and easy to use, outputs from forward transforms are not bitreversed but come with a strange permutation. I have not yet managed to find a formal solution to generate permutation tables for this, other than checking transform outputs for given inputs. However, the inverse transforms expect the same order, so for some tasks like convolution, there is no need to permute.

It contains gcc style inline assembly, so it might not work for some compilers.

This is a work in progress, but since it is useful for me at this stage, it might be so for others. License is the same as the original djbfft, which is in the public domain.

The result were obtained by running the benchmark.c on a STM32F466 MCU. All FFT were performed without bitreversing. 

Here the results for real transforms, r+ indicates forward, r- inverse transform:

|Transform|Cycles|Performance (N * log2(N)/cycles) |
|-|-|-|
|16 r+ CMSIS_5|395|::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|16 r+ FFT4CM4F|228|::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|16 r- CMSIS_5|599|::::::::::::::::::::::::::::::::::::::::::::::|
|16 r- FFT4CM4F|219|:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|32 r+ CMSIS_5|1826|::::::::::::::::::::::::::::::::::::::|
|32 r+ FFT4CM4F|649|:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|32 r- CMSIS_5|2204|:::::::::::::::::::::::::::::::|
|32 r- FFT4CM4F|648|::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|64 r+ CMSIS_5|3843|:::::::::::::::::::::::::::::::::::::::::::|
|64 r+ FFT4CM4F|1625|:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|64 r- CMSIS_5|4589|::::::::::::::::::::::::::::::::::::|
|64 r- FFT4CM4F|1632|:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|128 r+ CMSIS_5|7130|:::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|128 r+ FFT4CM4F|3786|:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|128 r- CMSIS_5|8627|:::::::::::::::::::::::::::::::::::::::::::::|
|128 r- FFT4CM4F|3862|:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|256 r+ CMSIS_5|16534|::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|256 r+ FFT4CM4F|8749|::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|256 r- CMSIS_5|19491|::::::::::::::::::::::::::::::::::::::::::::::|
|256 r- FFT4CM4F|8918|::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|512 r+ CMSIS_5|36324|:::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|512 r+ FFT4CM4F|19958|:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|512 r- CMSIS_5|42227|:::::::::::::::::::::::::::::::::::::::::::::::|
|512 r- FFT4CM4F|20354|:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|1024 r+ CMSIS_5|66296|:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|1024 r+ FFT4CM4F|45011|:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|1024 r- CMSIS_5|78083|:::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|1024 r- FFT4CM4F|45834|:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|2048 r+ CMSIS_5|151726|:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|2048 r+ FFT4CM4F|100364|::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|2048 r- CMSIS_5|175293|::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|2048 r- FFT4CM4F|102084|::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|4096 r+ CMSIS_5|331857|::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|4096 r+ FFT4CM4F|221514|:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|4096 r- CMSIS_5|378976|::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|4096 r- FFT4CM4F|225087|:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::|

Here the same for complex transforms - note that for size 4096, CMSIS wins.

|Transform|Cycles|Performance (N * log2(N)/cycles) |
|-|-|-|
|16 c+ CMSIS_5|882|:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|16 c+ FFT4CM4F|437|:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|16 c- CMSIS_5|1110|::::::::::::::::::::::::::::::::::::::::::::::::::|
|16 c- FFT4CM4F|454|:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|32 c+ CMSIS_5|2056|::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|32 c+ FFT4CM4F|1306|:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|32 c- CMSIS_5|2503|:::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|32 c- FFT4CM4F|1320|:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|64 c+ CMSIS_5|3978|::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|64 c+ FFT4CM4F|3148|::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|64 c- CMSIS_5|4499|::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|64 c- FFT4CM4F|3212|::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|128 c+ CMSIS_5|9581|:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|128 c+ FFT4CM4F|7487|::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|128 c- CMSIS_5|11325|:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|128 c- FFT4CM4F|7677|:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|256 c+ CMSIS_5|22317|::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|256 c+ FFT4CM4F|17596|:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|256 c- CMSIS_5|25947|::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|256 c- FFT4CM4F|17949|:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|512 c+ CMSIS_5|41816|::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|512 c+ FFT4CM4F|40422|:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|512 c- CMSIS_5|45511|::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|512 c- FFT4CM4F|41092|::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|1024 c+ CMSIS_5|95551|:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|1024 c+ FFT4CM4F|91310|::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|1024 c- CMSIS_5|110229|:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|1024 c- FFT4CM4F|92531|::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|2048 c+ CMSIS_5|217937|::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|2048 c+ FFT4CM4F|203577|::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|2048 c- CMSIS_5|248907|:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|2048 c- FFT4CM4F|206100|:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|4096 c+ CMSIS_5|412872|::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|4096 c+ FFT4CM4F|449093|:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|4096 c- CMSIS_5|445121|::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::|
|4096 c- FFT4CM4F|454142|::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::|


